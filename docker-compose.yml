name: servarr
services:
  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    environment:
      - PUID=13001
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
      - VERSION=latest
    devices:
      - /dev/dri:/dev/dri
    volumes: 
      - /home/nathan/servarr/config/plex-config:/config
      - /mnt/data/media:/data/media
      - /tmp/ramdisk:/transcode
    ports:
      - 32400:32400
    restart: always
  
  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr
    environment:
      - PUID=13002
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/overseerr-config:/config
    ports:
      - 5055:5055
    restart: always

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    network_mode: service:gluetun
    environment:
      - PUID=13003
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/sonarr-config:/config
      - /mnt/data:/data
    restart: always

  4ksonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: 4ksonarr
    network_mode: service:gluetun
    environment:
      - PUID=13003
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/4ksonarr-config:/config
      - /mnt/data:/data
    restart: always

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    network_mode: service:gluetun
    environment:
      - PUID=13004
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/radarr-config:/config
      - /mnt/data:/data
    restart: always

  4kradarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: 4kradarr
    network_mode: service:gluetun
    environment:
      - PUID=13004
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/4kradarr-config:/config
      - /mnt/data:/data
    restart: always

  bazarr: 
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    network_mode: service:gluetun
    environment:
      - PUID=13005
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/bazarr-config:/config
      - /mnt/data/media:/data/media
    restart: always
  
  4kbazarr: 
    image: lscr.io/linuxserver/bazarr:latest
    container_name: 4kbazarr
    network_mode: service:gluetun
    environment:
      - PUID=13005
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/4kbazarr-config:/config
      - /mnt/data/media:/data/media
    restart: always

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    network_mode: service:gluetun
    environment:
      - PUID=13006
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/prowlarr-config:/config
    restart: always

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    network_mode: service:gluetun
    environment:
      - PUID=13007
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
      - WEBUI_PORT=8080
    volumes:
      - /home/nathan/servarr/config/qbittorrent-config:/config
      - /mnt/data/torrents:/data/torrents
    restart: always

  # maintainerr:
  #   image: ghcr.io/jorenn92/maintainerr:latest 
  #   container_name: maintainerr
  #   user: 13008:13000
  #   volumes:
  #     - /home/nathan/servarr/config/maintainerr-config:/opt/data
  #   environment:
  #     - TZ=Canada/Pacific
  #   ports:
  #     - 6246:6246
  #   restart: always

  4kmaintainerr:
    image: ghcr.io/jorenn92/maintainerr:latest 
    container_name: 4kmaintainerr
    user: 13008:13000
    volumes:
      - /home/nathan/servarr/config/maintainerr-config:/opt/data
    environment:
      - TZ=Canada/Pacific
    ports:
      - 6246:6246
    restart: always

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: tautulli
    depends_on:
      - plex
    environment:
      - PUID=13009
      - PGID=13000
      - UMASK=002
      - TZ=Canada/Pacific
    volumes:
      - /home/nathan/servarr/config/tautulli-config:/config
    ports:
      - 8181:8181
    restart: always

  wizarr:
    image: ghcr.io/wizarrrr/wizarr:latest
    container_name: wizarr
    volumes:
      - /home/nathan/servarr/config/wizarr-config:/data/database
    ports:
      - 5690:5690
    restart: always
  
  # recyclarr:
  #   image: ghcr.io/recyclarr/recyclarr:latest
  #   container_name: recyclarr
  #   user: 13010:13000
  #   volumes:
  #     - /home/nathan/servarr/config/recyclarr-config:/config
  #   environment:
  #     - TZ=Canada/Pacific
  #   restart: always

  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    restart: always

  gluetun:
    image: qmcgaw/gluetun:latest
    container_name: gluetun
    volumes:
      - /home/nathan/servarr/config/gluetun-config:/gluetun
    cap_add:
      - NET_ADMIN
    environment:
      - VPN_SERVICE_PROVIDER=airvpn
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${GLUETUN_PRIVATE_KEY}
      - WIREGUARD_PRESHARED_KEY=${GLUETUN_PRESHARED_KEY}
      - WIREGUARD_ADDRESSES=10.155.80.253/32
      - SERVER_CITIES=Vancouver
      - FIREWALL_VPN_INPUT_PORTS=24242
      - TZ=Canada/Pacific
    ports:
      - 8191:8191 # flaresolverr
      - 8989:8989 # sonarr
      - 8988:8988 # 4ksonarr
      - 7878:7878 # radarr
      - 7877:7877 # 4kradarr
      - 6767:6767 # bazarr
      - 6766:6766 # 4kbazarr
      - 9696:9696 # prowlarr
      - 8080:8080 # qbittorrent
      - 24242:24242 # qbittorrent
      - 24242:24242/udp # qbittorrent
    restart: always

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    network_mode: service:gluetun
    environment:
      - TZ=Canada/Pacific
    restart: always

  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /etc/localtime:/etc/localtime:ro
    command: --cleanup true --remove-volumes true --schedule "30 9 * * *" --rolling-restart true
    restart: always
